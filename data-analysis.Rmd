---
title: Traffic Data Analysis
output: html_document
---


### loading data
```{r}
library(dplyr)
library(ggplot2)
df <- read.csv("all-semi-unique.csv")

```
### removing advertisments information
```{r}
cols <- grep("ad/*",names(df),value=F)
df2 <- df[,-cols]
```
### checking for columns with only one value
```{r}
unique(df2$rd.rp.type)
df2 <- subset(df2,select=-c(rd.rp.type))
unique(df2$rd.img)
unique(df2$rd.cl)
df2 <- subset(df2,select=-c(rd.cl))
```
### removing some columns
```{r}
df2 <- subset(df2,select=-c(rd.img))
```
### check if for duplicates in rows
```{r}
df3 <- subset(df2,select=-c(rd.hr,rd.mn,rd.rp.hr,rd.rp.mn,crawl_date))
df3 <- df3[!duplicated(df3),]
```
### add new columns for the dates of the road and comment
```{r}
x <- strptime(df2[,"crawl_date"],format = "%a %b %d %H:%M",tz = "UTC")
hrs <- function(u) {
 x <- u * 3600
 return(x)
}
mns <- function(m) {
 x <- m * 60
 return(x)
}
df2$tmp_date <- x
df2 <- mutate(df2, date= tmp_date-hrs(rd.hr)-mns(rd.mn))
df2 <- mutate(df2, rp.date= tmp_date-hrs(rd.rp.hr)-mns(rd.rp.mn))
df2 <- subset(df2,select=-c(rd.hr,rd.mn,rd.rp.hr,rd.rp.mn,crawl_date,tmp_date))
df2 <- df2[!duplicated(df2),]
```
### check for further duplicates in cmid
```{r}
length(unique(df2$rd.rp.cmid))
```
### accommodate for diffrences in seconds
```{r}
data <- subset(df2, !duplicated(df2[,'rd.rp.cmid']))
```
### examine the frequency for each status for the comments 
```{r}
qplot(rd.rp.stid,data = data)
```

### examine rows with comment status that is NA
```{r}
sum(is.na(data$rd.rp.stid))
not.labeled <- data[is.na(data$rd.rp.stid),]
```

### examine the status  that corresponds to each status id
```{r}
head(data[ which(data$rd.rp.stid==1), ])
head(data[ which(data$rd.rp.stid==2), ])
head(data[ which(data$rd.rp.stid==3), ])
head(data[ which(data$rd.rp.stid==4), ])
head(data[ which(data$rd.rp.stid==5), ])
head(data[ which(data$rd.rp.stid==6), ])
head(data[ which(data$rd.rp.stid==7), ])
head(data[ which(data$rd.rp.stid==8), ])
head(data[ which(data$rd.rp.stid==9), ])
head(data[ which(data$rd.rp.stid==10), ])
```
### create new status = 11 corresponds to clear
```{r}
data$rd.rp.stid <- ifelse(grepl("(.)*clear(.)*", data$rd.rp.cm), 11,data$rd.rp.stid)
sum(is.na(data$rd.rp.stid))
not.labeled <- data[is.na(data$rd.rp.stid),]
qplot(rd.rp.stid,data = data)
```

### adding a column for positive comments (1,2,3 and 11)
```{r}
data2 <- data[!is.na(data$rd.rp.stid),]
data2$pos.com <- ifelse(data2$rd.rp.stid == 1 | data2$rd.rp.stid == 2 | data2$rd.rp.stid == 3 | data2$rd.rp.stid == 11 , 1,0)
```
### adding a column for negative comments (4,5,7,8,9,10)
```{r}
data2$neg.com <- ifelse(data2$rd.rp.stid == 4 | data2$rd.rp.stid == 5 | data2$rd.rp.stid == 7 | data2$rd.rp.stid == 8 | data2$rd.rp.stid == 9 | data2$rd.rp.stid == 10 , 1,0)
```